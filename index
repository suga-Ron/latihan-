<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      body { background-color: #f8f9fa; padding: 20px; }
      .search-box { border-radius: 25px; padding: 12px 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border: 1px solid #ced4da; }
      .inventory-card { 
        background: #ffffff; border-radius: 12px; border-left: 5px solid #198754; 
        box-shadow: 0 4px 6px rgba(0,0,0,0.05); transition: 0.3s; margin-bottom: 15px;
      }
      .inventory-card:hover { transform: translateY(-3px); box-shadow: 0 6px 12px rgba(0,0,0,0.1); }
      .label-custom { font-size: 0.75rem; color: #6c757d; text-transform: uppercase; font-weight: bold; }
      .data-value { font-size: 1.1rem; font-weight: 600; color: #212529; }
      .hidden { display: none; }
    </style>
  </head>
  <body>
    <div class="container" style="max-width: 600px;">
      
      <div id="menu-utama" class="text-center mt-5">
        <h2 class="mb-4">üì¶ Inventory Monitor</h2>
        <button class="btn btn-success btn-lg px-5 py-3 shadow" onclick="bukaOverview()">
          MULAI PENCARIAN
        </button>
      </div>

      <div id="halaman-search" class="hidden">
        <button class="btn btn-sm btn-link text-decoration-none mb-3" onclick="kembali()">‚Üê Kembali ke Menu</button>
        
        <div class="mb-4">
          <input type="text" id="inputCari" class="form-control search-box" 
                 placeholder="Ketik Code (Contoh: C48810)..." onkeyup="prosesCari()">
        </div>

        <div id="container-hasil">
          <p class="text-center text-muted">Sedang menyiapkan data...</p>
        </div>
      </div>

    </div>

    <script>
      let databaseLokal = [];

      function bukaOverview() {
        document.getElementById('menu-utama').classList.add('hidden');
        document.getElementById('halaman-search').classList.remove('hidden');
        
        // Ambil data dari Google Sheet saat aplikasi dibuka
        google.script.run.withSuccessHandler(function(res) {
          databaseLokal = res;
          tampilkanData(res);
        }).getInventoryData();
      }

      function kembali() {
        document.getElementById('menu-utama').classList.remove('hidden');
        document.getElementById('halaman-search').classList.add('hidden');
      }

      function tampilkanData(data) {
        const container = document.getElementById('container-hasil');
        if (!data || data.length === 0) {
          container.innerHTML = '<div class="alert alert-warning text-center">Data tidak ditemukan.</div>';
          return;
        }

        let html = '';
        data.forEach(item => {
          html += `
            <div class="card inventory-card p-3">
              <div class="row">
                <div class="col-6 mb-2">
                  <div class="label-custom">Code Barang</div>
                  <div class="data-value text-primary">${item.code || '-'}</div>
                </div>
                <div class="col-6 mb-2 text-end">
                  <div class="label-custom">Lokasi</div>
                  <div class="badge bg-light text-dark border">${item.lokasi || '-'}</div>
                </div>
                <div class="col-6">
                  <div class="label-custom">Weekly</div>
                  <div class="data-value text-secondary">${item.weekly || '0'}</div>
                </div>
                <div class="col-6 text-end">
                  <div class="label-custom">Quantity (Qty)</div>
                  <div class="data-value text-success">${item.qty || '0'}</div>
                </div>
              </div>
            </div>`;
        });
        container.innerHTML = html;
      }

      function prosesCari() {
        const kataKunci = document.getElementById('inputCari').value.toLowerCase();
        
        // Filter data berdasarkan CODE atau LOKASI
        const hasilFilter = databaseLokal.filter(item => {
          return item.code.toString().toLowerCase().includes(kataKunci) || 
                 item.lokasi.toString().toLowerCase().includes(kataKunci);
        });
        
        tampilkanData(hasilFilter);
      }
    </script>
  </body>
</html>
